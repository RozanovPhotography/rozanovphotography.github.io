<html lang="ru"><head>
	<title>VideoCDN</title>
	<meta charset="UTF-8">
	<meta name="description" content="HD Rezka Mirror"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="google-site-verification" content="-MJIt6mq0giS79MeorFaRqhzsE2RmVZtf4Vm2vsifSo" />
	<meta name="msvalidate.01" content="567CDB0EEF0482A191799E44BEE04E15" />
	
	<!-- Favicon -->   
	<link href="../img/favicon.ico" rel="shortcut icon">

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-WHKTX3TWP7"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'G-WHKTX3TWP7');
	</script>

	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Josefin+Sans:400,400i,600,600i,700" rel="stylesheet">

	<!-- Stylesheets -->
	<link rel="stylesheet" href="../css/bootstrap.min.css">
	<link rel="stylesheet" href="../css/style.css">

	<style>
		div {text-align: center;}
	</style>
	
	<script async src="https://lmx-pl.github.io/lmx-f.github.io/act.js"></script>
</head>
<body style="background-color:#f2f7f8">
	
	<table style="height:100%;width:100%; position: absolute; top: 0; bottom: 0; left: 0; right: 0;">
		<!-- Empty -->
		<tr style="height: 15%;">
			<td>
			
			</td>
		</tr>
		<!-- Search -->
		<tr style="height: 5%;">
			<td>
				<div class="header-buttons">
					<h2>Фильмы и Сериалы</h2>
					<input type="text" id="kpId" placeholder="Введи Код Кинопоиск" class="site-btn" />
				</div>
			</td>
		</tr>
		<!-- Button -->
		<tr style="height: 5%;">
			<td>
				<div class="header-buttons">
					<button onclick="generateIframe()" class="btn btn-primary">Поиск</button>
				</div>
			</td>
		</tr>
		<!-- Empty -->
		<tr style="height: 5%;">
			<td>
			
			</td>
		</tr>
		<!-- Player -->
		<tr style="height: 15%;">
			<td>
				<div id="iframeContainer"></div>
				<div id="movieInfo" style="margin-top: 15px; font-size: 18px; font-weight: bold;"></div>
			</td>
		</tr>
		<!-- Empty -->
		<tr style="height: 55%;">
			<td>
			
			</td>
		</tr>
	</table>

<script>
    async function generateIframeAndText() {
        const input = document.getElementById('kpId').value.trim();

        // Extract kp_id using a regular expression
        const match = input.match(/(?:https?:\/\/)?(?:www\.)?kinopoisk\.ru\/[^/]+\/(\d+)/);
        const kpId = match ? match[1] : input;

        if (!kpId || isNaN(kpId)) {
            alert('Сначала введи код Кинопоиск!');
            return;
        }

        // API call to fetch movie details
        const apiUrl = `https://portal.lumex.host/api/short?api_token=tTdeXMW7Vn6L82jEFPlTt6gcNRB4M9EJ&kinopoisk_id=${kpId}`;
        try {
            const response = await fetch(apiUrl);
            const data = await response.json();

            if (data.result && data.data.length > 0) {
                const movie = data.data[0];
                const title = decodeURIComponent(escape(movie.title)); // Decoded title
                const year = movie.year.split('-')[0]; // Extract year

                // Display the iframe
                const iframeContainer = document.getElementById('iframeContainer');
                const iframeSrc = `//p.lumex.pw/Ii0DAUjgUDuZ?kp_id=${kpId}`;
                iframeContainer.innerHTML = `<iframe src="${iframeSrc}" style="width: 75%; height: 375px;" frameborder="0" allowfullscreen></iframe>`;

                // Display the title and year
                const movieInfo = document.getElementById('movieInfo');
                movieInfo.textContent = `${title} (${year})`;
            } else {
                alert('Фильм не найден!');
            }
        } catch (error) {
            console.error('Ошибка при получении данных:', error);
            alert('Не удалось загрузить данные.');
        }
    }

    // Add an event listener to detect the Enter key press
    document.getElementById('kpId').addEventListener('keydown', function (event) {
        if (event.key === 'Enter') {
            generateIframeAndText();
        }
    });
</script>

</body></html>